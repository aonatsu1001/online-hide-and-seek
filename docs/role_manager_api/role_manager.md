# ゲーム役割管理API仕様書

## 概要
このドキュメントは、オンラインかくれんぼゲームにおけるプレイヤーの役割選択とリアルタイム通信に関するAPIエンドポイントの詳細を記述します。

## ベースURL
`http://localhost:8000/game`

## エンドポイント

### 1. 役割選択
- **パス:** `/select-role`
- **HTTPメソッド:** `POST`
- **目的:** プレイヤーが「鬼（SEEKER）」か「隠れる側（HIDER）」かを選択します。
- **リクエストボディ:**
    ```json
    {
      "username": "string", // 役割を選択するプレイヤーのID（ユーザー名など）
      "role": "string"      // 選択する役割 ("HIDER" または "SEEKER")
    }
    ```
- **レスポンス:**
    - **ステータスコード:** `200 OK`
    - **ボディ:**
        ```json
        {
          "message": "string" // 役割選択成功メッセージ
        }
        ```
    - **ステータスコード:** `422 Unprocessable Entity` (バリデーションエラー)
    - **ボディ:**
        ```json
        {
          "detail": "無効なデータです" // またはFastAPIのデフォルトバリデーションエラー
        }
        ```
    - **説明:** 指定された`username`と`role`（"HIDER"または"SEEKER"）をサーバーに送信し、サーバーはプレイヤーの役割を記録します。役割が選択されると、WebSocketを通じて他の接続中のクライアントに役割情報がブロードキャストされます。

### 2. WebSocket接続
- **パス:** `/ws`
- **プロトコル:** `WebSocket`
- **目的:** リアルタイム通信のためのWebSocket接続を確立します。
- **接続確立時:**
    - サーバーは、現在接続している全プレイヤーの役割情報をJSON形式で送信します。
    - 例: `{"player1": "HIDER", "player2": "SEEKER"}`
- **メッセージ受信時:**
    - クライアントからメッセージを受信した場合、現時点では特別な処理は行いませんが、接続を維持します。
- **メッセージ送信時 (サーバーからクライアントへ):**
    - プレイヤーが役割を選択するたびに、サーバーは接続中のすべてのクライアントに最新のプレイヤー役割情報をブロードキャストします。
- **切断時:**
    - クライアントが切断された場合、サーバーは接続リストからそのクライアントを削除します。
- **説明:** クライアントがこのエンドポイントに接続すると、サーバーとの間に永続的な通信チャネルが確立されます。役割選択などのイベントが発生すると、サーバーはこのWebSocketを通じてクライアントにリアルタイムで情報を送信します。これは、ゲームの状態をリアルタイムで同期するために使用されます。

## エラーハンドリング
- APIリクエストが失敗した場合、HTTPステータスコードとJSON形式のエラーメッセージが返されます。
- WebSocket接続の場合、接続が切断されるか、エラーが発生した場合にサーバー側でログが出力されます。
